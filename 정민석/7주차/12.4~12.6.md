# 12.4 최초 입력 지연 (FID)

![image](https://github.com/Deep-Dive-React/react-study-archive/assets/42230162/961bd7f4-55b4-4225-9a22-b77feb1b49a0)


수강신청을 할 때 모두 성공하시는 편들 이신가요?? 저는 주로 반클 정도 하는 편입니다 :)

수강신청을 떠올려보면 버튼을 클릭한 시점은 10:00 이지만 실제로 처리되는 시간은 그보다 훨씬 늦은 시간이 되는 경우가 많습니다

원하는 시간에 처리가 되지 않으면 엄청난 불편함을 겪는데요 이러한 사례에서 느낄 수 있듯 웹사이트의 **반응속도**도 중요하다고 합니다.

이러한 반응성을 측정하는 지표를 FID(first input delay)라고 합니다.

> FID : 사용자가 페이지와 처음 상호 작용할 떄부터 해당 상호작용에 대한 응답으로 브라우저가 실제 이벤트 핸들러 처리를 시작하기까지의 시간을 측정합니다.

개발자들이 특별한 경우를 제외하고 일부러 이러한 delay를 만들지는 않는데요

그럼에도 불구하고 이러한 딜레이가 생기는 이유는 **싱글스레드**에서 실행되는 자바스크립트의 메인 스레드가 바쁜 상황이기 때문입니다.

### 사용자 경험 종류
구글은 사용자 경험을 RAIL로 분류해서 정의했는데요

- Response : 사용자 입력에 대한 반응 속도, 50ms 미만 이벤트로 처리할 것
- Animation : 애니메이션의 각 프레임을 10ms 이하로 생성할 것
- Idle : 유휴 시간을 극대화해 페이지가 50ms 이내에 사용자 입력에 응답하도록 할 것
- Load : 5초 이내에 컨텐츠를 전달하고 인터렉션을 준비할 것

이 중 Response에 해당하는 것이 최초 입력 지연입니다.

### FID 측정 방법
- 개발자 도구의 network 탭을 활용하면 이러한 성능에 대해 자세히 볼 수 있습니다.
- [Event Timing API]([url](https://www.w3.org/TR/event-timing/))를 사용

## 기준 점수

![image](https://github.com/Deep-Dive-React/react-study-archive/assets/42230162/acdc4a03-e0a5-4b80-ad08-2265e1bf12e9)

0 ~ 100ms : 좋은 점수

100 ~ 300ms : 개선이 필요한 점수

300ms ~ : 나쁜 점수

## 개선 방안
그렇다면 어떻게 개선할 수 있는지 알아봅시다.

1. 실행에 오래걸리는 긴 작업을 분리

- 반드시 웹페이지에서 해야하는 작업인지 파악 후 서버에서 별도 처리
- 긴 작업을 분리할 수 있다면 여러 작업으로 분리
  
2. 자바스크립트 코드 최소화

- 개발자 도구를 사용하면 현재까지 사용되지 않은 코드들을 볼 수 있습니다 -> 이러한 코드들을 우선순위를 낮춰서 불러오는 것이 바람직하다
- 브라우저에서 지원하지 않는 기능을 위해 사용되는 폴리필 추가에 대해 고려를 하고 사용을 해야합니다.
  
3. 타사 자바스크립트 코드 실행의 지연

- Google Analytics, Firebase등 제 3자의 타사 스크립트를 사용하는데 이로 인해 메인 스레드가 잠시 점유되는 등 문제가 발생할 수 있음 


# 12.5 누적 레이아웃 이동 (CLS)

![image](https://github.com/Deep-Dive-React/react-study-archive/assets/42230162/d956d125-b06a-4a31-b5ee-bed76d645efc)

컨텐츠를 보다가 갑자기 나타나는 광고들때문에 사용자 경험이 낮아지기도 합니다

이러한 예기치 않은이동에 대한 지표를 계산하는 것이 바로 누적 레이아웃 이동(Cumulative Layout Shift)입니다. 낮을수록 좋다고 합니다.

## 의미

useEffect는 렌더링이 한번 끝난 후에 콜백함수를 실행하는 훅입니다.

이로 인해 레이아웃이 다 그려지고 또 한번 렌더링을 수행해 CLS에 좋지 않은 점수를 받을 가능성이 커집니다.

### 계산 방식
영향분률 * 거리분율 (점)

- 영향분률 : 레이아웃 이동이 발생한 요소의 전체 높이와 뷰포트 높이의 비율
- 거리분율 : 레이아웃 이동이 발생한 요소가 뷰포트 대비 얼마나 이동했는지

## 개선방안

- 삽입이 예상되는 요소를 위한 추가적인 공간 확보

![image](https://github.com/Deep-Dive-React/react-study-archive/assets/42230162/8aa063bf-f737-4e70-9c45-e62aedf3c35c)

유튜브의 로딩 화면은 다음과 같이 
1. 스켈레톤 뷰
2. 글자 렌더링
3. 썸네일 렌더링
으로 진행이 되어 미리 크기에 맞는 공간을 할당해주어 CLS를 방지하고 있습니다.

- 폰트 로딩 최적화

1. FOUT : 기본 폰트로 로딩이 된 후 설정한 폰트가 뒤늦게 적용되는 현상
2. FOIT : 지정한 폰트가 보이지 않고 기본 폰트도 없어 텍스트가 없다가 폰트가 로딩되며 렌더링되는 현상

폰트 또한 고유의 높이와 너비를 가지고 있기 떄문에 cls가 발생할 수 있습니다.

한국어 폰트는 크기가 더 큰 것으로 알고 있어서 적절한 조치를 해야할 것 같습니다.

- 적절한 이미지 크기 설정

이미지의 auto 속성 대신 실제 값을 주면 브라우저가 면적을 할당해 둡니다.








