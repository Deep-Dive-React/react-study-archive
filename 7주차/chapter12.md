# 12장 | 모든 웹 개발자가 관심을 가져야 할 핵심 웹 지표
## 12.1 웹사이트와 성능
웹사이트에서 자신의 이목을 끄는 것만큼 방문객들은 웹사이트가 빠르길 기대한다. 아무리 화려하고 멋진 웹사이트라 하더라도 그러한 화려함을 위해 방문객의 시간을 희생해야 한다면 이는 무의미하다.

## 12.2 핵심 웹 지표란?
핵심 웹 지표 : 구글에서 만든 지표로, 웹사이트에서 뛰어난 사용자 경험을 제공하는 데 필수적인 지표를 일컫는 용어다.  
> 구글에서 뽑는 핵심 지표  
> * 최대 콘텐츠풀 페인트
> * 최소 입력 지연
> * 누적 레이아웃 이동

또한 두 지표는 핵심까지는 아니지만, 특정 문제를 진단하는 데 사용될 수 있다고 언급했다.
> * 최초 바이트까지의 시간(TTFB)
> * 최초 콘텐츠풀 시간(FCP)

## 12.3 최대 콘텐츠풀 페인트(LCP)
### 12.3.1 정의
최대 콘텐츠풀 페인트 : 페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간
#### 뷰포트란?
사용자에게 현재 노출되는 화면을 의미한다.
> 큰 이미지와 텍스트

    <img>
    <svg> 내부의 <image>
    poster 속성을 사용하는 <video>
    url()을 통해 불러온 배경 이미지가 있는 요소
    텍스트와 같이 인라인 텍스트 요소를 포함하고 있는 블록 레벨 요소

### 12.3.2 의미
* 사용자에게 있어 로딩이란 일단 뷰포트 영역에 보이는 부분을 기준으로 할 것이므로 뷰포트에 메인 콘텐츠가 화면에 완전히 전달되는 속도를 기준으로 한다면 사용자는 페이지 로딩이 완료됐다고 체감하는 시간과 매우 비슷하게 측정할 수 있을 것이다.
* 따라서 사용자에게 페이지의 정보를 화면에 전달하는 속도를 객관적으로 판단하기 위한 지표로 만들어진 것이 바로 최대 콘텐츠풀 페인트이다.

### 12.3.3 예제
최대 콘텐츠풀 페인트는 페이지 로딩에 따라 변화하는 지표다. 

### 12.3.4 기준 점수
LCT 등의 각종 지표 점수를 측정하는 방법으로는 먼저 직접 자바스크립트 API를 호출하는 방법과 다른 도구를 활용하는 방법이 있는데, 손쉬운 측정을 위해서는 대부분 후자를 택한다.

### 12.3.5 개선 방안
#### 텍스트는 언제나 옳다
#### 이미지는 어떻게 불러올 것인가?
#### 조심해야 할 사항
* 이미지 무손실 압축 
* loading = lazy 주의 
* fadein과 같은 각종 에니메이션
* 클라이언트에서 빌드하지 말 것
* 최대 콘텐츠풀 리소스는 직접 호스팅

## 12.4 최초 입력 지연(FID)
### 12.4.1 정의
웹사이트의 반응성을 측정하는 지표.  
사용자가 페이지와 처음 상호 작용할 때부터 해당 상호 작용에 대한 응답으로 브라우저가 실제로 이벤트 핸들러 처리를 시작하기까지의 시간을 측정한다.

### 12.4.2 의미
이벤트가 발생하는 시점에 최대한 메인 스레드가 다른 작업을 처리할 수 있도록 여유를 만들어 둬야 사용자에게 빠른 반응성을 보장할 수 있다.

### 12.4.3 예제
염두해두어야 할 것은 FID는 이벤트가 처리되는 것이 얼마나 지연되는지만 판단한다는 것이다. 만약 이벤트 핸들러의 실행 시간을 측정하고 싶다면 Event Timing API를 사용하는 것이 좋다.

### 12.4.4 기준 점수
최초 입력 지연의 좋은 점수를 얻기 위해서는 100ms 이내로 응답이 와야 하며, 300mx 이내인 경우 보통, 그 이후의 경우에는 나쁨으로 처리된다.

### 12.4.5 개선 방안
#### 실행에 오래 걸리는 긴 작업 분리
#### 자바스크립트 코드 최소화
#### 타사 자바스크립트 코드 실행의 지연

## 12.5 누적 레이아웃 이동(CLS)
### 12.5.1 정의
페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표를 계산하는 것이 바로 누적 레이아웃 이동(CLS: Cumulative Layout Shift)라고 한다. 다른 지표와 마찬가지로 이 지표가 낮을 수록 좋다.

### 12.5.2 의미
최초 렌더링 이후에 실행되는 useEffect가 많을수록, 그리고 이 useEffect가 렌더링에 영향을 미칠수록 이 누적 레이아웃 이동에 좋지 못한 점수를 받을 가능성이 커진다.

### 12.5.3 예제
클라이언트에서 미리 노출이 예상되는 부분을 HTML로 자리 잡아 두는 것이 누적 레이아웃 지표에 큰 도움이 된다.  
그러나 홈 화면에 뜨는 배너광고와 같이 동적으로 결정되는 요소는 서버에서 미리 결정해서 내려오지 않는다면 누적 레이아웃 이동을 야기한다.  

### 12.5.4 기준점수
누적 레이아웃 이동의 경우 0.1 이하인 경우 좋음, 0.25 이하인 경우 보통이며 그 외에는 개선이 필요한 나쁜 점수로 보고된다.

### 12.5.5 개선 방안
#### 삽입이 예상되는 요소를 위한 추가적인 공간 확보
#### 폰트 로딩 최적화
#### 적절한 이미지 크기 설정

### 12.5.6 핵심 웹 지표는 아니지만 성능 확인에 중요한 지표들
1. 최초 바이트까지의 시간(TTFB)
2. 최초 콘텐츠풀 페인트(FCP)

## 12.6 정리
* 대부분 웹 애플리케이션의 완성에만 초점을 맞추고 있고, 그 이후에 또다시 개발해야 할 페이지가 기다리고 있어 실무에서 약간의 성능 개선을 위한 시간조차 할애하기 어렵다.  
* 하지만 개발자라면 성능 또한 완성도 만큼이나 중요하게 살펴봐야 한다.  
* 아무리 좋은 콘텐츠가 웹페이지에서 제공되고 있다 하더라도 사용자의 환경은 생각보다 성능이 열악하며, 속도는 느리고, 마지막으로 인내심도 많지 않다.
