# 07장 | 크롬 개발자 도구를 활용한 애플리케이션 분석
## 7.1 크롬 개발자 도구란?
* 크롬 개발자 도구 : 크롬에서 제공하는 개발자용 도구로, 웹페이지에서 일어나는 거의 모든 일을 확인할 수 있다.
* 디버깅하고 싶은 페이지에 접속한 뒤 메뉴에서 보기 -> 개발자 도구 순으로 선택한다.
* 크롬 개발자 도구에서 웹사이트를 제대로 디버깅하고 싶다면 시크릿 모드 또는 프라이빗 모드라 불리는 개인정보 보호 모드에서 페이지와 개발자 도구를 여는 것을 권장한다.

## 7.2 요소 탭
현재 웹페이지를 구성하고 있는 HTML, CSS 등의 정보를 확인할 수 있다.
### 7.2.1 요소화면
* 왼쪽 화면은 현재 웹페이지를 구성하는 HTML을 나타내고 이 중에서 원하는 태그를 클릭하면 브라우저 페이지의 해당 요소가 강조되고, 해당 태그와 관련된 정보를 확인할 수 있다.
* 요소 화면에서는 HTML을 보는 것뿐만 아니라 직접 코드를 수정해서 웹페이지에서 어떻게 보이는지 빠르게 확인할 수 있다.
### 7.2.2 요소 정보
요소 탭 오른쪽에서는 해당 요소와 관련된 정보를 얻을 수 있다.  
왼쪽 요소 화면이 웹페이지 요소의 구조를 확인하고 추가, 수정, 삭제를 할 수 있는 공간이라면 오른쪽 요소 정보에서는 해당 요소와 관련된 모든 정보를 확인할 수 있다.
* 스타일:요소와 관련된 스타일 정보를 나타낸다.
* 계산됨:해당 요소의 크기, 패딩, 보더, 마진과 각종 CSS 적용 결괏값을 알 수 있는 탭이다.
* 레이아웃:CSS 그리드나 레이아웃과 관련된 정보를 확인할 수 있다.
* 이벤트 리스너:현재 요소에 부착된 각종 이벤트 리스너를 확인할 수 있다.
* DOM 중단점:앞서 설명한 중단점이 있는지 알려주는 탭
* 속성:해당 요소가 가지고 있는 모든 속성값
* 접근성:웹 이용에 어려움을 겪는 장애인, 노약자를 위한 스크린리더기 등이 활용하는 값

## 7.3 소스 탭
* 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있다.  
* 소스 탭에서 유용한 것을 살펴보려면 디버깅하고 싶은 파일을 직접 열어야 한다.  
1. 감시:감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있다.
2. 중단점:현재 웹사이트에서 추가한 중단점을 확인할 수 있다.
3. 범위:현재 중단점에서의 스코프를 의미한다.
4. 호출 스택:현재 중단점의 콜스택 확인. 자바스크립트 코드가 실행되며 생성되는 실행 콘텍스트가 어떻게 저장되어 현재 어떤 모습을 하고 있는지 직접 볼 수 있따.
5. 전역 리스너:현재 전역 스코프에 추가된 리스너 목록을 확인할 수 있다.
6. XHR/가져오기,DOM,이벤트 리스너,CSP 위반 중단점:소스의 중단점 이외에 다양한 중단점을 확인할 수 있다.
☆ 소스 탭의 장점
1. 실제 애플리케이션을 실행하는 데 사용된 파일을 직접 볼 수 있다.
2. 중단점을 설정해 두면 빌드된 자바스크립트 또는 실제 개발 중인 스크립트 파일이 어떻게 실행되는지 눈으로 확인할 수 있다.
3. 스코프, 호출 스택 등 현재 자바스크립트가 실행되고 있는 구조도 확인할 수 있다.
4. 버그가 의심되는 지점을 디버깅하거나 실제로 소스코드상에서 어떤 식으로 작동하는지 확인하고 싶을 때 유용하다.

## 7.4 네트워크 탭
네트워크 탭에서는 해당 웹페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.  
웹페이지가 외부 데이터와 통신하는 정보를 확인하고 싶다면 네트워크 탭을 참조하면 된다.  
* 상단 : 네트워크 탭과 관련된 다양한 메뉴 확인
* 왼쪽 : 실제 해당 페이지를 불러오는 과정에서 발생한 네트워크 요청 확인
※ 리액트에서 동일한 주소의 요청이 두 번 실행되는 경우는 대부분 잘못된 useEffect의 사용으로 발생하는 문제다.
* 하단 : 페이지를 불러오는 기간 동안 발생한 총 요청 건수와 총 다운로드한 업로드 리소스의 크기 확인
※ 가급적 네트워크 리소스 요청 횟수와 크기를 줄일 필요가 있다.
* 스크린숏 캡처 기능 : 네트워크 요청 흐름에 따라 웹페이지가 어떻게 로딩되고 있는지 확인할 수 있다.
    네트워크 탭을 통해 집중적으로 확인해 봐야할 점
    1. 불필요한 요청 또는 중복되는 요청이 없는지
    2. 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
    3. 리소스를 불러오는 속도는 적절한지 너무 속도가 오래 걸리는 리소스는 없는지
    4. 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어지는지

## 7.5 메모리 탭
메모리 탭에서는 현재 웹페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.  
애플리케이션에서 발생하는 메모리 누수, 속도 저하, 웹페이지 프리징 현상을 확인할 수 있어 융용하다.  
프로파일링 작업을 거쳐야 원하는 정보를 볼 수 있다.
    프로파일링 유형 : 힙 스냅샷, 타임라인의 할당 계측, 할당 샘플링

### 7.5.1 자바스크립트 인스턴스 VM 선택
자바스크립트 VM 인스턴스 선택 항목을 보면 현재 실행 중인 자바스크립트 VM 인스턴스를 확인할 수 있다.  
환경별 힙 크기는 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.

### 7.5.2 힙 스냅샷
현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구  
힙 스냅샷을 촬영하는 시점을 기준으로 마치 사진으로 촬영하듯 메모리 현황을 보여준다.  
스냅샷 촬영을 제대로 활용하려면 하나의 스냅샷을 가지고 파악하는 것보다 스냅샷을 두 개 이상 촬영한 다음 그 차이만 비교하는 것이 낫다.  
또한 스냅샷을 활용하면 useMemo나 useCallback과 같은 의존성이 있는 값들이 정말로 렌더링 사이에 그대로 유지되는지 육안으로 확인할 수 있다.  

### 7.5.3 타임라인 할당 계측
스냅샷 촬영은 해당 시점의 메모리 내용만 촬영하는 프로파일링 기법이지만, 타임라인 할당 계측은 시간 흐름에 따라 메모리 변화를 확인할 수 있다.  
특정 변수를 클릭해서 전역 변수로 저장을 누르면 해당 변수가 무슨 값을 가지고 있는 객체인지 확인할 수 있다.  
메모리 변화를 일으킨 변수가 무엇인지, 해당 변수가 어느 정도 크기를 차지하고 있는지 확인할 수 있다.

### 7.5.4 할당 샘플링 
시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다는 점에서 할당 계측과 비슷하지만 자바스크립트 실행 스택별로 분석할 수 있고, 분석을 함수 단위로 한다는 차이가 있다.
문제가 되는 함수뿐만 아니라 파일명을 누르거나 마우스 오른쪽 버튼을 클릭한 후 소스 패널에 표시를 선택해 해당 함수가 어느 파일에서 어떻게 정의됐는지도 확인할 수 있다.

## 7.6 Next.js 환경 디버깅하기
사용자 기기의 성능과 스펙에 따라 같은 메모리 누수라도 다른 결과를 낳게 될 것이다.  
오래된 기기를 사용하는 사용자라면 메모리 누수로 인해 치명적인 영향을 받을 것이다.  
그러나 서버 사이드 렌더링을 수행하는 자바스크립트 환경에서 메모리 누수가 발생한다면 심각한 상황을 초래하게 될 것이다.  

### 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기
다음과 같은 방법으로 프로젝트를 실행한다.
    "dev" : NODE_OPTIONS='--inspect' next dev
그 다음 크롬 브라우저에서 chrome://inspect로 이동하고 Open dedicated DevTools for Node를 클릭하면 개발자 도구가 나타난다.  

### 7.6.2 Next.js 서버에 트래픽 유입시키기
서버 사이드 렌더링과 같이 서버에서 제공되는 서비스의 경우 서버를 실행한 뒤 사용자가 서서히 유입되면서 메모리 누수가 발생하는 경우가 많다. 따라서 서버에 직접 트래픽을 발생시켜서 확인하는 편이 제일 확실한 방법이다.  
사용자의 트래픽이 서버로 몰리는 상황을 시뮬레이션 해보자.
    ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"
ab은 아파치 제단에서 제공하는 웹서버 성능 검사 도구로, HTTP 서버의 성능을 벤치마킹할 수 있는 도구다.

### 7.6.3 Next.js의 메모리 누수 지점 확인하기
실제 디버깅 과정은 매우 어렵고 귀찮은 작업이다. 대부분의 경우에는 메모리 누수의 원인이 불명확하고, 코드를 아무리 봐도 잘 이해되지 않는 경우가 많기 때문에 메모리 누수가 의심되는 지점을 찾고, 코드를 수정하는 등의 긴 과정을 반복해야 한다.  
어렵지만 문제를 파고들다 보면 결국 원인을 파악하고 수정해서 더욱 안정적인 서비스를 제공할 수 있을 것이다.
